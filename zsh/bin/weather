#!/bin/bash

W_FILE="/Users/austinjones/.config/zsh/bin/weather.txt"

if [[ ! -f "$W_FILE" ]]; then
  ssh hollyw@73.113.23.66 "curl -s wttr.in" > $W_FILE
else
  F_DAY=$(stat -f "%Sm" weather.txt | date +"%F")
  TODAY=$(date +"%F")

  [[ "$F_DAY" != "$TODAY" ]] &&
    ssh hollyw@73.113.23.66 "curl -s wttr.in" > $W_FILE
fi

[[ "$1" == "-s" ]] &&
  sed "13q;d" $W_FILE |
    gsed 's/\x1b\[[0-9;]*m//g' |
    sed "s/[[:punct:]]F* */ /g; s/\(-*[0-9]*[0-9]\)/\1 /g" |
    tr -s ' ' '\n' |
    sort |
    sed -n -e '2p;$p' |
    tr '\n' '-' |
    sed 's/-$//g' ||
  tail -n 32 $W_FILE
